<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Вход - AEGIS Antivirus</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
</head>
<body>
    <div id="particles-js"></div>
    
    <header class="header">
        <nav class="nav container">
            <div class="nav-brand">
                <a href="/" class="logo-container">
                    <i class="fas fa-shield-alt logo-icon"></i>
                    <span class="logo-text">AEGIS</span>
                </a>
            </div>
            <div class="nav-menu">
                <a href="/" class="nav-link" data-translate="nav-home">Главная</a>
                <a href="/features" class="nav-link" data-translate="nav-features">Возможности</a>
                <a href="/download" class="nav-link" data-translate="nav-download">Скачать</a>
                <a href="/support" class="nav-link" data-translate="nav-support">Поддержка</a>
                <div class="mobile-nav-controls">
                    <a href="/register" class="btn btn-primary btn-full" data-translate="register">Регистрация</a>
                </div>
            </div>
            <div class="nav-controls">
                <button class="theme-toggle" id="themeToggle"><i class="fas fa-moon"></i></button>
                <select class="language-select" id="languageSelect">
                    <option value="ru">RU</option>
                    <option value="en">EN</option>
                </select>
                <a href="/register" class="btn btn-primary" data-translate="register">Регистрация</a>
            </div>
            <div class="mobile-menu-toggle"><span></span><span></span><span></span></div>
        </nav>
    </header>

    <section class="auth-page">
        <div class="auth-page-container">
            <div class="auth-visual-side">
                <div class="auth-visual-content">
                    <div class="auth-visual-badge">
                        <i class="fas fa-shield-alt"></i>
                        <span data-translate="secure-login">Защищённый вход</span>
                    </div>
                    <h1 data-translate="welcome-back">С возвращением!</h1>
                    <p data-translate="welcome-back-desc">Войдите в свой аккаунт для доступа к панели управления и настройкам защиты</p>
                    
                    <div class="auth-features">
                        <div class="auth-feature">
                            <div class="auth-feature-icon"><i class="fas fa-lock"></i></div>
                            <div class="auth-feature-text">
                                <h4 data-translate="encryption-256">256-bit шифрование</h4>
                                <p data-translate="encryption-desc">Ваши данные надёжно защищены</p>
                            </div>
                        </div>
                        <div class="auth-feature">
                            <div class="auth-feature-icon"><i class="fas fa-user-shield"></i></div>
                            <div class="auth-feature-text">
                                <h4 data-translate="privacy">Приватность</h4>
                                <p data-translate="privacy-desc">Мы не передаём ваши данные третьим лицам</p>
                            </div>
                        </div>
                        <div class="auth-feature">
                            <div class="auth-feature-icon"><i class="fas fa-clock"></i></div>
                            <div class="auth-feature-text">
                                <h4 data-translate="fast-access">Быстрый доступ</h4>
                                <p data-translate="fast-access-desc">Мгновенный вход в систему</p>
                            </div>
                        </div>
                    </div>
                    <div class="auth-visual-decoration">
                        <div class="decoration-circle circle-1"></div>
                        <div class="decoration-circle circle-2"></div>
                        <div class="decoration-circle circle-3"></div>
                    </div>
                </div>
            </div>

            <div class="auth-form-side">
                <div class="auth-form-container">
                    <div class="auth-form-header">
                        <div class="auth-logo-mobile"><i class="fas fa-shield-alt"></i></div>
                        <h2 data-translate="login-to-account">Вход в аккаунт</h2>
                        <p data-translate="login-desc">Введите свои данные для входа</p>
                    </div>

                    <form class="auth-form" id="loginForm">
                        <div class="form-group">
                            <label for="email">
                                <i class="fas fa-envelope"></i>
                                <span data-translate="email">Email</span>
                            </label>
                            <input type="email" id="email" name="email" required placeholder="example@mail.com">
                        </div>
                        
                        <div class="form-group">
                            <label for="password">
                                <i class="fas fa-lock"></i>
                                <span data-translate="password">Пароль</span>
                            </label>
                            <div class="password-input-wrapper">
                                <input type="password" id="password" name="password" required data-translate="enter-password" placeholder="Введите пароль">
                                <button type="button" class="password-toggle" onclick="togglePassword('password')">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </div>
                        </div>
                        
                        <div class="form-options">
                            <label class="checkbox-label">
                                <input type="checkbox" id="remember">
                                <span class="custom-checkbox"></span>
                                <span data-translate="remember-me">Запомнить меня</span>
                            </label>
                            <a href="#" class="forgot-link" onclick="openResetModal(); return false;" data-translate="forgot-password">Забыли пароль?</a>
                        </div>
                        
                        <button type="submit" class="btn btn-primary btn-full btn-large">
                            <span data-translate="sign-in">Войти</span>
                            <i class="fas fa-arrow-right"></i>
                        </button>
                    </form>

                    <div class="auth-form-footer">
                        <p><span data-translate="no-account">Нет аккаунта?</span> <a href="/register" data-translate="sign-up">Зарегистрироваться</a></p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Reset Password Modal -->
    <div class="modal-overlay" id="resetModal">
        <div class="modal-content reset-modal">
            <div class="modal-header">
                <h3><i class="fas fa-key"></i> <span data-translate="reset-password">Восстановление пароля</span></h3>
                <button class="modal-close" onclick="closeResetModal()"><i class="fas fa-times"></i></button>
            </div>
            <div class="modal-body">
                <p class="reset-description" data-translate="reset-description">Введите email, указанный при регистрации. Мы отправим вам ссылку для сброса пароля.</p>
                <form id="resetForm" onsubmit="handleResetPassword(event)">
                    <div class="form-group">
                        <label for="resetEmail">
                            <i class="fas fa-envelope"></i>
                            <span data-translate="email">Email</span>
                        </label>
                        <input type="email" id="resetEmail" name="resetEmail" required placeholder="example@mail.com">
                    </div>
                    <button type="submit" class="btn btn-primary btn-full" id="resetBtn">
                        <span data-translate="send-reset-link">Отправить ссылку</span>
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </form>
                <div class="reset-success" id="resetSuccess" style="display: none;">
                    <i class="fas fa-check-circle"></i>
                    <p data-translate="reset-email-sent">Письмо отправлено! Проверьте вашу почту.</p>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/particles.js@2.0.0/particles.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="script.js"></script>
    <script src="supabase-config.js"></script>
    <script>
        function togglePassword(inputId) {
            var input = document.getElementById(inputId);
            var icon = input.parentElement.querySelector('.password-toggle i');
            if (input.type === 'password') {
                input.type = 'text';
                icon.classList.remove('fa-eye');
                icon.classList.add('fa-eye-slash');
            } else {
                input.type = 'password';
                icon.classList.remove('fa-eye-slash');
                icon.classList.add('fa-eye');
            }
        }

        // Reset Password Modal Functions
        function openResetModal() {
            document.getElementById('resetModal').classList.add('active');
            document.getElementById('resetSuccess').style.display = 'none';
            document.getElementById('resetForm').style.display = 'block';
            document.getElementById('resetEmail').value = '';
            document.body.style.overflow = 'hidden';
        }

        function closeResetModal() {
            document.getElementById('resetModal').classList.remove('active');
            document.body.style.overflow = '';
        }

        async function handleResetPassword(e) {
            e.preventDefault();
            var email = document.getElementById('resetEmail').value;
            var btn = document.getElementById('resetBtn');
            
            btn.disabled = true;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
            
            try {
                var result = await resetPassword(email);
                if (result) {
                    document.getElementById('resetForm').style.display = 'none';
                    document.getElementById('resetSuccess').style.display = 'flex';
                }
            } catch (err) {
                console.error(err);
            }
            
            btn.disabled = false;
            btn.innerHTML = '<span data-translate="send-reset-link">Отправить ссылку</span><i class="fas fa-paper-plane"></i>';
        }

        // Close modal on overlay click
        document.getElementById('resetModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeResetModal();
            }
        });

        // Close modal on Escape key
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeResetModal();
            }
        });
    </script>
</body>
</html>